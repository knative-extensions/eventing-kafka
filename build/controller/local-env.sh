#!/usr/bin/env bash

# Ensure The Script Is Being Sourced
[[ "${BASH_SOURCE[0]}" == "${0}" ]] && echo -e "\nWARNING: 'Source' this script for the environment setup to apply to the current session!\n"

# Set Local Testing Environment Variables
export SYSTEM_NAMESPACE="knative-eventing"
export SERVICE_ACCOUNT="eventing-kafka-channel-controller"
export METRICS_PORT="8081"
export METRICS_DOMAIN="knative.dev/eventing"
export KAFKA_PROVIDER="azure"
export KAFKA_BROKERS="eventhub.servicebus.windows.net:9093"
export KAFKA_OFFSET_COMMIT_MESSAGE_COUNT="50"
export KAFKA_OFFSET_COMMIT_DURATION_MILLIS="30000"
export KAFKA_OFFSET_COMMIT_ASYNC="false"
export KAFKA_SECRET=kafka-credentials
export KAFKA_USERNAME="\$ConnectionString"
export KAFKA_PASSWORD="TODO"
export CHANNEL_IMAGE="gcr.io/knative-nightly/eventing-kafka/eventing-kafka-channel:latest"
export CHANNEL_REPLICAS="1"
export DISPATCHER_IMAGE="gcr.io/knative-nightly/eventing-kafka/eventing-kafka-dispatcher:latest"
export DEFAULT_NUM_PARTITIONS="4"
export DEFAULT_REPLICATION_FACTOR="1"
export DEFAULT_RETENTION_MILLIS="604800000"
export DISPATCHER_REPLICAS="1"
export DISPATCHER_RETRY_INITIAL_INTERVAL_MILLIS="500"
export DISPATCHER_RETRY_TIME_MILLIS="300000"
export DISPATCHER_RETRY_EXPONENTIAL_BACKOFF="true"
export DISPATCHER_MEMORY_REQUEST=""
export DISPATCHER_CPU_REQUEST="300m"
export DISPATCHER_CPU_LIMIT="500m"
export DISPATCHER_MEMORY_REQUEST="50Mi"
export DISPATCHER_MEMORY_LIMIT="128Mi"
export CHANNEL_MEMORY_REQUEST="50Mi"
export CHANNEL_MEMORY_LIMIT="100Mi"
export CHANNEL_CPU_REQUEST="100m"
export CHANNEL_CPU_LIMIT="200m"

# Log Environment Variables
echo ""
echo "Exported Env Vars"
echo "-----------------"
echo "SYSTEM_NAMESPACE=${SYSTEM_NAMESPACE}"
echo "SERVICE_ACCOUNT=${SERVICE_ACCOUNT}"
echo "METRICS_PORT=${METRICS_PORT}"
echo "METRICS_DOMAIN=${METRICS_DOMAIN}"
echo "KAFKA_PROVIDER=${KAFKA_PROVIDER}"
echo "KAFKA_BROKERS=${KAFKA_BROKERS}"
echo "KAFKA_OFFSET_COMMIT_MESSAGE_COUNT=${KAFKA_OFFSET_COMMIT_MESSAGE_COUNT}"
echo "KAFKA_OFFSET_COMMIT_DURATION_MILLIS=${KAFKA_OFFSET_COMMIT_DURATION_MILLIS}"
echo "KAFKA_OFFSET_COMMIT_ASYNC=${KAFKA_OFFSET_COMMIT_ASYNC}"
echo "KAFKA_SECRET=${KAFKA_SECRET}"
echo "KAFKA_USERNAME=${KAFKA_USERNAME}"
echo "KAFKA_PASSWORD=${KAFKA_PASSWORD}"
echo "CHANNEL_IMAGE=${CHANNEL_IMAGE}"
echo "CHANNEL_REPLICAS=${CHANNEL_REPLICAS}"
echo "DISPATCHER_IMAGE=${DISPATCHER_IMAGE}"
echo "DEFAULT_NUM_PARTITIONS=${DEFAULT_NUM_PARTITIONS}"
echo "DEFAULT_REPLICATION_FACTOR=${DEFAULT_REPLICATION_FACTOR}"
echo "DEFAULT_RETENTION_MILLIS=${DEFAULT_RETENTION_MILLIS}"
echo "DISPATCHER_REPLICAS=${DISPATCHER_REPLICAS}"
echo "DISPATCHER_RETRY_INITIAL_INTERVAL_MILLIS=${DISPATCHER_RETRY_INITIAL_INTERVAL_MILLIS}"
echo "DISPATCHER_RETRY_TIME_MILLIS=${DISPATCHER_RETRY_TIME_MILLIS}"
echo "DISPATCHER_RETRY_EXPONENTIAL_BACKOFF=${DISPATCHER_RETRY_EXPONENTIAL_BACKOFF}"
echo "DISPATCHER_CPU_REQUEST=${DISPATCHER_CPU_REQUEST}"
echo "DISPATCHER_CPU_LIMIT=${DISPATCHER_CPU_LIMIT}"
echo "DISPATCHER_MEMORY_REQUEST=${DISPATCHER_MEMORY_REQUEST}"
echo "DISPATCHER_MEMORY_LIMIT=${DISPATCHER_MEMORY_LIMIT}"
echo "CHANNEL_MEMORY_REQUEST=${CHANNEL_MEMORY_REQUEST}"
echo "CHANNEL_MEMORY_LIMIT=${CHANNEL_MEMORY_LIMIT}"
echo "CHANNEL_CPU_REQUEST=${CHANNEL_CPU_REQUEST}"
echo "CHANNEL_CPU_LIMIT=${CHANNEL_CPU_LIMIT}"
echo ""
